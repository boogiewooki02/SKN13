##################################################################
#  streamlit/01_streamlit_chat_exam.py
#  ì±—ë´‡ ëŒ€í™” ê´€ë ¨ ìœ„ì ¯ 

# 1. chat_input() : ì‚¬ìš©ì ì…ë ¥ì„ ë°›ëŠ” ìœ„ì ¯
# 2. chat_message() : ë©”ì„¸ì§€ë¥¼ container(ë‚´ìš© ì°½)ì— ì…ë ¥í•˜ëŠ” ìœ„ì ¯.

# chat_input(): str
# - ì‚¬ìš©ì ì…ë ¥ì„ ë°›ëŠ” ìœ„ì ¯.
# - ì‚¬ìš©ìê°€ ì…ë ¥í•œ ë‚´ìš©ì€ ì—”í„°ë¥¼ ì¹˜ë©´ ë°˜í™˜ë˜ê³ , ì…ë ¥í¼ì— ì‘ì„±ëœ ê¸€ì€ ì§€ì›Œì§„ë‹¤.
# - ì½”ë“œê°€ ì–´ë””ì— ìœ„ì¹˜í•˜ë“ ì§€ ìƒê´€ì—†ì´ ë§¨ ì•„ë˜ì— ìœ„ì¹˜í•œë‹¤.
# - ì£¼ìš”íŒŒë¼ë¯¸í„°
#    - placeholder:str - ì…ë ¥í¼ì— í‘œì‹œí•  íŒíŠ¸
#    - key:str|int - ìœ„ì ¯ì˜ ê³ ìœ  ì‹ë³„ì
#    - max_chars: int - ìµœëŒ€ ì…ë ¥ ê¸€ììˆ˜. None(default): ì œí•œ ì—†ìŒ
#    - on_submit: Callable - ì—”í„°ë¥¼ ëˆŒë €ì„ ë•Œ(submit) í˜¸ì¶œí•  í•¨ìˆ˜
# - https://docs.streamlit.io/develop/api-reference/chat/st.chat_input

# chat_message(name, *, avatar=None): Container
# - ë©”ì„¸ì§€ë¥¼ container(ë‚´ìš© ì°½)ì— ì…ë ¥í•˜ëŠ” ìœ„ì ¯.
# - ë°˜í™˜ëœ containerì— write() í•˜ê±°ë‚˜ with ë¬¸ì„ ì´ìš©í•´ write() í•œë‹¤.
# - parameter
#    - name:str =  ì…ë ¥í•˜ëŠ” ë©”ì„¸ì§€ ì‘ì„±ì. ("assistant", "ai", "human", "user" or str)
#        - "assistant", "ai": ì±—ë´‡ì´ ì‘ì„±í•œ ë©”ì„¸ì§€, "human", "user": ì‚¬ìš©ìê°€ ì‘ì„±í•œ ë©”ì„¸ì§€
#    - avatar: str|st.image|None 
#        - ë¬¸ìì—´, emoji, ì´ë¯¸ì§€ ë“±ì„ ì‚¬ìš©í•˜ì—¬ ì•„ë°”íƒ€ ì´ë¯¸ì§€ë¥¼ í‘œí˜„í•œë‹¤.
#        - ë©”ì„¸ì§€ ì‘ì„±ìë¥¼ í‘œí˜„í•˜ëŠ” ì•„ë°”íƒ€ ì´ë¯¸ì§€.
#        - avatar=None ì´ë©´ nameì— ë”°ë¼ ê²°ì •ëœë‹¤. 
#              - nameì´ user, human, assistant, ai ì¼ ê²½ìš° ì •í•´ì§„ ì•„ì´ì½˜ì´ ì‚¬ìš©ëœë‹¤.
#              - nameì´ ë‹¤ë¥¸ ë¬¸ìì—´ì¼ ê²½ìš° ì²«ë²ˆì§¸ ê¸€ìë¥¼ ì•„ë°”íƒ€ë¡œ ì‚¬ìš©í•œë‹¤.
#        - avatar ë¥¼ ì§€ì •í•˜ë©´ ì§€ì •í•œ avatarë¥¼ ì‚¬ìš©í•œë‹¤.
#              - ë‹¨ ì´ë¦„ì´ user, human, assistant, ai ì¼ ê²½ìš° default avatar ê°€ ë‚˜ì˜¤ê³  ê·¸ ë’¤ì— ì§€ì •í•œ avatarê°€ ë‚˜ì˜¨ë‹¤.
# - https://docs.streamlit.io/develop/api-reference/chat/st.chat_message

# st.session_state: ì‚¬ìš©ìì˜ ìƒíƒœë¥¼ ì €ì¥í•˜ëŠ” ê°ì²´
#   - í˜ì´ì§€ê°€ reload(rerun) ë˜ë”ë¼ë„ ìœ ì§€ ë˜ì•¼í•˜ëŠ” ê°’ë“¤ì„ ì €ì¥í•˜ëŠ” ì €ì¥ì†Œ ì—­í• .
#       - ë³€ìˆ˜ì— ì €ì¥ëœ ê°’ì€ rerunì‹œ ì‚¬ë¼ì§€ê²Œ ëœë‹¤. ê·¸ëŸ°ë° rerun í›„ì—ë„ ê·¸ ê°’ì´ ìœ ì§€ ë˜ì–´ì•¼ í•˜ëŠ” ê²½ìš°ê°€ ìˆë‹¤. ì´ëŸ° ê°’ë“¤ì„ ì €ì¥í•˜ëŠ” ì €ì¥ì†Œ.
#       - dictionary í˜•ì‹ìœ¼ë¡œ key=value í˜•íƒœë¡œ ê°’ì„ ì €ì¥í•œë‹¤.
#   - key ê°€ ìˆëŠ”ì§€ ì—¬ë¶€ í™•ì¸
#       - in ì—°ì‚°ìë¥¼ ì´ìš©í•´ í™•ì¸í•œë‹¤. `if "key" in st.session_state:` í˜•ì‹ìœ¼ë¡œ í™•ì¸.
#   - ê°’ ì¡°íšŒ
#       - st.session_state.key ë˜ëŠ” st.session_state['key'] ë¥¼ ì´ìš©í•´ ì¡°íšŒí•œë‹¤.
#   - ê°’ ì €ì¥
#       - st.session_state.key = value ë˜ëŠ” st.session_state['key'] = value ë¥¼ ì´ìš©í•´ ì €ì¥í•œë‹¤.
#       - ê°’ì„ ì €ì¥í•˜ë ¤ëŠ” keyê°€ ì—†ìœ¼ë©´ KeyError ë°œìƒí•œë‹¤. ê·¸ë˜ì„œ ë¯¸ë¦¬ keyë¥¼ ìƒì„±í•´ ë†“ê³  ì‚¬ìš©í•´ì•¼ í•œë‹¤.
# 
#   - https://docs.streamlit.io/develop/api-reference/caching-and-state/st.session_state
##################################################################
import streamlit as st
import random

idx = random.randint(0, 9)
chatbot_message_list = ["ì˜¤ëŠ˜ ë‚ ì”¨ê°€ ì–´ë–¤ê°€ìš”?",
"ì ì‹¬ìœ¼ë¡œ ë­˜ ë¨¹ìœ¼ë©´ ì¢‹ì„ê¹Œìš”?",
"ì§‘ì—ì„œ í•  ìˆ˜ ìˆëŠ” ê°„ë‹¨í•œ ìš´ë™ì€ ë­ê°€ ìˆë‚˜ìš”?",
"ìš”ì¦˜ ì¸ê¸° ìˆëŠ” ë“œë¼ë§ˆ ì¶”ì²œí•´ ì¤„ ìˆ˜ ìˆë‚˜ìš”?",
"íš¨ê³¼ì ìœ¼ë¡œ ê³µë¶€í•˜ë ¤ë©´ ì–´ë–»ê²Œ í•´ì•¼ í•˜ë‚˜ìš”?",
"ì£¼ë§ì— ì–´ë””ë¡œ ë†€ëŸ¬ ê°€ë©´ ì¢‹ì„ê¹Œìš”?",
"ì ì´ ì•ˆ ì˜¬ ë•ŒëŠ” ì–´ë–»ê²Œ í•˜ë©´ ì¢‹ì„ê¹Œìš”?",
"íš¨ìœ¨ì ìœ¼ë¡œ ì •ë¦¬ì •ëˆì„ í•˜ë ¤ë©´ ë­ë¶€í„° í•´ì•¼ í•˜ë‚˜ìš”?",
"ê±´ê°•ì— ì¢‹ì€ ê°„ì‹ìœ¼ë¡œëŠ” ì–´ë–¤ ê²Œ ìˆë‚˜ìš”?",
"ìŠ¤íŠ¸ë ˆìŠ¤ë¥¼ í‘¸ëŠ” ì¢‹ì€ ë°©ë²•ì´ ìˆì„ê¹Œìš”?"]

ai_message = chatbot_message_list[idx] # ì‘ë‹µ ë°ì´í„°

st.title("Chatbot ìœ„ì ¯ íŠœí† ë¦¬ì–¼")

# ì‚¬ìš©ìì˜ í”„ë¡¬í”„íŠ¸(ì§ˆë¬¸)ì„ ì…ë ¥ë°›ëŠ” ìœ„ì ¯
prompt = st.chat_input("User Prompt") # ì‚¬ìš©ìê°€ ì…ë ¥í•œ ë¬¸ìì—´ì„ ë°˜í™˜
# print(prompt)

## ëŒ€í™” ì‘ì—…
if prompt is not None:
    # llmì— prompt ì „ë‹¬ -> ì‘ë‹µ ìˆ˜ì‹  -> í™”ë©´ì— ëŒ€í™” ë‚´ìš© ì¶œë ¥(chat_message)
    with st.chat_message("User"):
        st.write(prompt) # containerì— ì¶œë ¥
    with st.chat_message("AI", avatar="ğŸ¦–"):
        st.write(ai_message)
